<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electroblade's Insulin App</title>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
<df-messenger
  intent="WELCOME"
  chat-title="Insulin Guide"
  agent-id="3b473a42-607f-4416-a2a9-fc871b121146"
  language-code="en"
></df-messenger>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
            color: #007bff;
        }
        section {
            margin: 20px auto;
            padding: 20px;
            max-width: 800px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        #rebolus, #rebasal {
            font-size: 1.2rem;
            color: #007bff;
        }
        #insulinChart {
            width: 100%;
            max-width: 700px;
            margin: auto;
        }
        .form-control {
            margin-bottom: 15px;
        }
        #deleteAll {
            background-color: #dc3545;
            color: #fff;
            border: none;
        }
        #deleteAll:hover {
            background-color: #c82333;
        }
        .danger-section {
            text-align: center;
            color: #dc3545;
        }
        .danger-section p {
            margin-bottom: 20px;
        }
        #insulinSensitivity {
            font-size: 1.2rem;
            color: #007bff;
        }
        #carbRatio {
            font-size: 1.2rem;
            color: #007bff;
        }
        .card {
            width: 300px;
            height: 400px;
            background: #dba50f;
            border-radius: 15px;
            box-shadow: 1px 5px 60px 0px #94896a;
            border-radius: 15px;
            padding: 20px;
        }
        .card-border-top {
            width: 60%;
            height: 3%;
            background: #6b64f3;
            margin: auto;
            border-radius: 0px 0px 15px 15px;
        }
        .card span {
            font-weight: 600;
            color: white;
            text-align: center;
            display: block;
            padding-top: 10px;
            font-size: 16px;
        }
        .card .job {
            font-weight: 400;
            color: white;
            display: block;
            text-align: center;
            padding-top: 3px;
            font-size: 12px;
        }
        .card .img {
            width: 70px;
            height: 80px;
            background: #ffffff;
            border-radius: 15px;
            margin: auto;
            margin-top: 25px;
        }
        .card button {
            padding: 8px 25px;
            display: block;
            margin: auto;
            border-radius: 8px;
            border: none;
            margin-top: 30px;
            background: #6b64f3;
            color: white;
            font-weight: 600;
        }
        .card button:hover {
            background: #534bf3;
        }
        .modal-body {
            padding: 0%;
        }
        .center-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 30vh;
            width: 100%;
        }

.modal-body {
    padding: 0%;
}
.center-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 30vh;
    width: 100%;
}
.timecard {
  align-items: center;
  width: 280px;
  height: 150px;
  border-radius: 15px;
  box-shadow: rgb(0,0,0,0.7) 5px 10px 50px ,rgb(0,0,0,0.7) -5px 0px 250px;
  display: flex;
  color: white;
  justify-content: center;
  position: relative;
  flex-direction: column;
  background: linear-gradient(to right, rgb(20, 30, 48), rgb(36, 59, 85));
  cursor: pointer;
  transition: all 0.3s ease-in-out;
  overflow: hidden;
}

.timecard:hover {
  box-shadow: rgb(0,0,0) 5px 10px 50px ,rgb(0,0,0) -5px 0px 250px;
  animation: shake 0.5s;
  animation-iteration-count: 1;
}

#time-text {
  font-size: 50px;
  margin-top: 0px;
  margin-left: 15px;
  font-weight: 600;
  font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
}

#day-text {
  font-size: 18px;
  margin-top: 0px;
  margin-left: 15px;
  font-weight: 500;
  font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
}

    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

        .navbar {
            background-color: #1c8ad9;
            overflow: hidden;
            display: flex;
            justify-content: space-around;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            padding: 14px 20px;
            text-align: center;
        }

        .navbar a:hover {
            background-color: #575757;
            color: white;
        }


        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        iframe {
            width: 100%;
            height: 400px;
            border: none;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover, .close:focus {
            color: black;
            text-decoration: none;
        }

.themeswitch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

.themeswitch #input-theme {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #2196f3;
  -webkit-transition: 0.4s;
  transition: 0.4s;
  z-index: 0;
  overflow: hidden;
}

.sun-moon {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: yellow;
  -webkit-transition: 0.4s;
  transition: 0.4s;
}

#input-theme:checked + .slider {
  background-color: black;
}

#input-theme:focus + .slider {
  box-shadow: 0 0 1px #2196f3;
}

#input-theme:checked + .slider .sun-moon {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
  background-color: white;
  -webkit-animation: rotate-center 0.6s ease-in-out both;
  animation: rotate-center 0.6s ease-in-out both;
}

.moon-dot {
  opacity: 0;
  transition: 0.4s;
  fill: gray;
}

#input-theme:checked + .slider .sun-moon .moon-dot {
  opacity: 1;
}

.slider.round {
  border-radius: 34px;
}

.slider.round .sun-moon {
  border-radius: 50%;
}

#moon-dot-1 {
  left: 10px;
  top: 3px;
  position: absolute;
  width: 6px;
  height: 6px;
  z-index: 4;
}

#moon-dot-2 {
  left: 2px;
  top: 10px;
  position: absolute;
  width: 10px;
  height: 10px;
  z-index: 4;
}

#moon-dot-3 {
  left: 16px;
  top: 18px;
  position: absolute;
  width: 3px;
  height: 3px;
  z-index: 4;
}

#light-ray-1 {
  left: -8px;
  top: -8px;
  position: absolute;
  width: 43px;
  height: 43px;
  z-index: -1;
  fill: white;
  opacity: 10%;
}

#light-ray-2 {
  left: -50%;
  top: -50%;
  position: absolute;
  width: 55px;
  height: 55px;
  z-index: -1;
  fill: white;
  opacity: 10%;
}

#light-ray-3 {
  left: -18px;
  top: -18px;
  position: absolute;
  width: 60px;
  height: 60px;
  z-index: -1;
  fill: white;
  opacity: 10%;
}

.cloud-light {
  position: absolute;
  fill: #eee;
  animation-name: cloud-move;
  animation-duration: 6s;
  animation-iteration-count: infinite;
}

.cloud-dark {
  position: absolute;
  fill: #ccc;
  animation-name: cloud-move;
  animation-duration: 6s;
  animation-iteration-count: infinite;
  animation-delay: 1s;
}

#cloud-1 {
  left: 30px;
  top: 15px;
  width: 40px;
}

#cloud-2 {
  left: 44px;
  top: 10px;
  width: 20px;
}

#cloud-3 {
  left: 18px;
  top: 24px;
  width: 30px;
}

#cloud-4 {
  left: 36px;
  top: 18px;
  width: 40px;
}

#cloud-5 {
  left: 48px;
  top: 14px;
  width: 20px;
}

#cloud-6 {
  left: 22px;
  top: 26px;
  width: 30px;
}

@keyframes cloud-move {
  0% {
    transform: translateX(0px);
  }

  40% {
    transform: translateX(4px);
  }

  80% {
    transform: translateX(-4px);
  }

  100% {
    transform: translateX(0px);
  }
}

.stars {
  transform: translateY(-32px);
  opacity: 0;
  transition: 0.4s;
}

.star {
  fill: white;
  position: absolute;
  -webkit-transition: 0.4s;
  transition: 0.4s;
  animation-name: star-twinkle;
  animation-duration: 2s;
  animation-iteration-count: infinite;
}

#input-theme:checked + .slider .stars {
  -webkit-transform: translateY(0);
  -ms-transform: translateY(0);
  transform: translateY(0);
  opacity: 1;
}

#star-1 {
  width: 20px;
  top: 2px;
  left: 3px;
  animation-delay: 0.3s;
}

#star-2 {
  width: 6px;
  top: 16px;
  left: 3px;
}

#star-3 {
  width: 12px;
  top: 20px;
  left: 10px;
  animation-delay: 0.6s;
}

#star-4 {
  width: 18px;
  top: 0px;
  left: 18px;
  animation-delay: 1.3s;
}

@keyframes star-twinkle {
  0% {
    transform: scale(1);
  }

  40% {
    transform: scale(1.2);
  }

  80% {
    transform: scale(0.8);
  }

  100% {
    transform: scale(1);
  }
}

.l {
  display: block;
  margin-bottom: 1.5em;
  font-size: 1em;
  cursor: pointer;
}

.l {
  background-color: rgba(0, 0, 0, 0.7);
  border-radius: 0.75em;
  box-shadow: 0.125em 0.125em 0 0.125em rgba(0, 0, 0, 0.3) inset;
  color: #fdea7b;
  display: inline-flex;
  align-items: center;
  margin: auto;
  padding: 0.15em;
  width: 3em;
  height: 1.5em;
  transition:
    background-color 0.1s 0.3s ease-out,
    box-shadow 0.1s 0.3s ease-out;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.l:before,
.l:after {
  content: "";
  display: block;
}

.l:before {
  background-color: #d7d7d7;
  border-radius: 50%;
  width: 1.2em;
  height: 1.2em;
  transition:
    background-color 0.1s 0.3s ease-out,
    transform 0.3s ease-out;
  z-index: 1;
}

.l:after {
  background:
    linear-gradient(transparent 50%, rgba(0, 0, 0, 0.15) 0) 0 50% / 50% 100%,
    repeating-linear-gradient(90deg, #bbb 0, #bbb, #bbb 20%, #999 20%, #999 40%)
      0 50% / 50% 100%,
    radial-gradient(circle at 50% 50%, #888 25%, transparent 26%);
  background-repeat: no-repeat;
  border: 0.25em solid transparent;
  border-left: 0.4em solid #d8d8d8;
  border-right: 0 solid transparent;
  transition:
    border-left-color 0.1s 0.3s ease-out,
    transform 0.3s ease-out;
  transform: translateX(-22.5%);
  transform-origin: 25% 50%;
  width: 1.2em;
  height: 1em;
  box-sizing: border-box;
}
/* Checked */
.l:checked {
  background-color: rgba(0, 0, 0, 0.45);
  box-shadow: 0.125em 0.125em 0 0.125em rgba(0, 0, 0, 0.1) inset;
}

.l:checked:before {
  background-color: currentColor;
  transform: translateX(125%);
}

.l:checked:after {
  border-left-color: currentColor;
  transform: translateX(-2.5%) rotateY(180deg);
}
/* Other States */
.l:focus {
  /* Usually an anti-A11Y practice but set to remove an annoyance just for this demo */
  outline: 0;
}






</style>
</head>
<body onload="startUp()">


    <div class="navbar animate__animated animate__fadeInDown">
        <a href="#" onclick="openModal('profileModal')">Profile</a>
        <a href="#" onclick="openModal('moreOptionsModal')">More Options</a>
        <a href="#" onclick="openModal('insulinCalculatorModal')">Insulin Dosage Calculator</a>
        <a href="#" onclick="openModal('reportGenerationModal')">Report Generation</a>
    </div>

    <div class="center-wrapper">
        <div class="timecard animate__animated animate__rubberBand">
            <p id="time-text"><span>null</span>
            <p id="date-text"><span>null</span></p>
        </div>
    </div>





    <section id="insulinRecord">
        <h2>Insulin Record</h2>
        <div class="mb-3">
            <input type="number" id="insulinno" class="form-control" placeholder="Enter amount of insulin">

            <input type="datetime-local" id="insulintime" class="form-control">

            <label for="insulinTypeInjected" class="form-label mt-3">Insulin Type</label>
            <select id="insulinTypeInjected" class="form-control">
                <option value="" disabled selected>Select an option</option>
                <option value="basal">Basal</option>
                <option value="bolus">Bolus</option>
            </select>
        </div>
        <button class="btn btn-primary" onclick="submitInsulin()">Submit</button>
        <canvas id="insulinChart" class="mt-4 pdf-content"></canvas>
    </section>

    <section id="insulinLogs" class="pdf-content">
        <h2>Insulin Logbook</h2>
        <div id="logContainer">
            <!-- Logs will be dynamically populated here -->
        </div>
    </section>

    <section id="insulinInfo" class="pdf-content">
        <h2>Insulin Information</h2>
        <p><b>Bolus Left: </b><span id="rebolus">Set up your profile first in the profile tab above!</span></p>
        <p><b>Basal Left: </b><span id="rebasal">Set up your profile first in the profile tab above!!</span></p>
        <p><b>Insulin Sensitivity Description (Correction Factor): </b><span id="insulinSensitivity">Set up your profile first in the profile tab above!!</span></p>
        <p><b>Carbohydrate Ratio: </b><span id="carbRatio">Set up your profile first in the profile tab above!!</span></p>
    </section>

    <section id="dangerArea" class="danger-section">
        <h2>DANGER AREA</h2>
        <p>Be careful with this section!</p>
        <button id="deleteAll" class="btn" onclick="deleteAllData()">Delete All Data</button>
    </section>
    
    <!-- Floating Modal Trigger Button -->
    <button class="btn btn-warning floating-btn move-left" data-bs-toggle="modal" data-bs-target="#infoModal">
        Contact Us
    </button>
    
    <!-- Modal HTML -->
    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="card">
                      <div class="card-border-top">
                      </div>
                      <div class="img">
                      </div>
                      <span>Electroblade</span>
                      <p class="job">Computer Enthusiast</p>
                      <a href="https://g.dev/electroblade"><button> Google Developer Page
                      </button></a>
                    </div>
                </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span id="profileCloseTag" class="close" onclick="closeModal('profileModal')">&times;</span>
            <section id="personalizeProfile">
              <h2 id="profileModalHeading">Personalize Your Profile</h2>
              <div class="mb-3">
                  <!-- Input for Body Weight -->
                  <label for="bodyweight" class="form-label">Body Weight (kg)</label>
                  <input type="number" id="bodyweight" class="form-control" placeholder="Enter your body weight (kg)" min="1">

                  <!-- Input for Personal Data -->
                   <label for="userName" class="form-label mt-3">Name</label>
                  <input type="text" id="userName" class="form-control" placeholder="Enter your full name" min="1">
          
                  <!-- Input for Age -->
                  <label for="age123" class="form-label mt-3">Age</label>
                  <input type="number" id="age123" class="form-control" placeholder="Enter your age" min="1">
          
                  <!-- Input for Basal Dose -->
                  <label for="dosedBasal" class="form-label mt-3">Basal Dose (optional)</label>
                  <input type="number" id="dosedBasal" class="form-control" placeholder="Enter basal dose (if applicable)" min="0">
          
                  <!-- Dropdown for Basal Type -->
                  <label for="basalType" class="form-label mt-3">Basal Type</label>
                  <select id="basalType" class="form-control">
                      <option value="" disabled selected>Select Basal Type</option>
                      <option value="longacting">Long-Acting (Lantus, other glargine insulins)</option>  <!-- Last for up to 24hrs -->
                      <option value="intermediate">Intermediate-acting (NPH (Humulin N, Novolin N))</option>  <!-- Last for up to 12hrs -->
                      <option value="ultra-long-acting">Ultra-Long Acting (Toujeo, Tresiba)</option>  <!-- Last for up to 36hrs -->
                  </select>
                  <!-- Dropdown for Bolus Type -->
                  <label for="bolusType" class="form-label mt-3">Bolus Type</label>
                  <select id="bolusType" class="form-control">
                      <option value="" disabled selected>Select Bolus Type</option>
                      <option value="fastacting">Fast Acting</option>  <!-- Last for up to 24hrs -->
                      <option value="rapid-acting">Rapid Acting</option>
                  </select>
          
                  <!-- Input for Activity Level -->
                  <label for="activityLevel" class="form-label mt-3">Activity Level</label>
                  <select id="activityLevel" class="form-control">
                      <option value="" disabled selected>Select Activity Level</option>
                      <option value="sedentary">Sedentary</option>
                      <option value="moderate">Moderate</option>
                      <option value="active">Active</option>
                  </select>
              
              <!-- Submit Button -->
              <button class="btn btn-success mt-3" onclick="submitData()">Submit</button>
          </section>
          
        </div>
    </div>

    <!-- More Options Modal -->
    <div id="moreOptionsModal" class="modal">
        <div class="modal-content">
            <span id="moreOptionsCloseTag" class="close" onclick="closeModal('moreOptionsModal')">&times;</span>
            <p1 style="color: white;">Theme: </p1>
            <br>
            <label class="themeswitch">
                <input id="input-theme" type="checkbox"/>
                <div class="slider round">
                  <div class="sun-moon">
                    <svg id="moon-dot-1" class="moon-dot" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="moon-dot-2" class="moon-dot" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="moon-dot-3" class="moon-dot" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="light-ray-1" class="light-ray" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="light-ray-2" class="light-ray" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="light-ray-3" class="light-ray" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
              
                    <svg id="cloud-1" class="cloud-dark" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="cloud-2" class="cloud-dark" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="cloud-3" class="cloud-dark" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="cloud-4" class="cloud-light" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="cloud-5" class="cloud-light" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                    <svg id="cloud-6" class="cloud-light" viewBox="0 0 100 100">
                      <circle cx="50" cy="50" r="50"></circle>
                    </svg>
                  </div>
                  <div class="stars">
                    <svg id="star-1" class="star" viewBox="0 0 20 20">
                      <path
                        d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                      ></path>
                    </svg>
                    <svg id="star-2" class="star" viewBox="0 0 20 20">
                      <path
                        d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                      ></path>
                    </svg>
                    <svg id="star-3" class="star" viewBox="0 0 20 20">
                      <path
                        d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                      ></path>
                    </svg>
                    <svg id="star-4" class="star" viewBox="0 0 20 20">
                      <path
                        d="M 0 10 C 10 10,10 10 ,0 10 C 10 10 , 10 10 , 10 20 C 10 10 , 10 10 , 20 10 C 10 10 , 10 10 , 10 0 C 10 10,10 10 ,0 10 Z"
                      ></path>
                    </svg>
                  </div>
                </div>
              </label>
              <br><br>
              <p1 style="color: white;">Dynamic Background for clock </p1>
              <input class="l" type="checkbox" />

        </div>




    </div>

    <!-- Insulin Dosage Calculator Modal -->
    <div id="insulinCalculatorModal" class="modal">
        <div class="modal-content">
            <span id="insulinCalculatorCloseTag" class="close" onclick="closeModal('insulinCalculatorModal')">&times;</span>
            <iframe src="https://www.example.com/insulin-calculator" title="Insulin Dosage Calculator"></iframe>
        </div>
    </div>

    <div id="reportGenerationModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span id="reportGenerationCloseTag" class="close" onclick="closeModal('reportGenerationModal')">&times;</span>
            <h3 style="color: white;">Report Generation</h3>
            <button type="button" onclick="generatePDF()">Generate Report</button>

          </div>
    </div>


    
    <style>
        .floating-btn {
            position: fixed;
            bottom: 20px;
            right: auto;
            z-index: 1000;
            border-radius: 50px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            left: 10px; /* Adjusts the distance from the left edge */
            bottom: 10px;
        }
        .floating-btn:hover {
            background-color: #e0a800;
            color: #fff;
        }
        .danger-section {
            background-color: #f8d8d8;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .danger-section p {
            margin-bottom: 20px;
        }

.modal-content {
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;

}


    </style>
    
    

    <script>
        let chartInstance = null;
        const supabaseUrl = "${SUPABASE_URL}";
        const supabaseAnonKey = "${SUPABASE_ANON_KEY}";
        const supabase = supabase.createClient(supabaseUrl, supabaseKey)
        console.log(supabaseUrl)
        console.log(supabaseAnonKey)

        async function logDatainCloud(){
                const { data, error } = await supabase
                .from('users')  // 'users' is your table name
                .insert([
                  {
                    name: 'John Doe',
                    email: 'john.doe@example.com',
                  },
                ]);

              if (error) {
                console.error('Error inserting data:', error);
              } else {
                console.log('Inserted data:', data);
              }
            }

        function submitData() {
            const weight = parseFloat(document.getElementById("bodyweight").value);
            const age = parseInt(document.getElementById("age123").value, 10);
            const basalDose = parseFloat(document.getElementById("dosedBasal").value);
            const nameofuser = document.getElementById("userName").value;


            if (!weight || !age || !document.getElementById("basalType").value || !document.getElementById("bolusType").value || !document.getElementById("activityLevel").value) {
                swal("Error!", "Please fill in all required fields.", "error");
                return;
            }

            const totalInsulin = Math.round(weight * 1.5); 
            let bolus, basal, insulin_sensetivity, carbRatio;

            if (!basalDose) {
                bolus = Math.round((totalInsulin / 10) * 6);
                basal = Math.round((totalInsulin / 10) * 4);
            } else {
                bolus = totalInsulin - basalDose;
                basal = basalDose;
            }

            
            
            insulin_sensetivity = 100/totalInsulin;
            insulin_sensetivity = insulin_sensetivity.toFixed(2);
            insulin_sensetivity = parseFloat(insulin_sensetivity);

            carbRatio = 500/totalInsulin
            carbRatio = carbRatio.toFixed(2);
            carbRatio = parseFloat(carbRatio);

            localStorage.setItem("weight", weight);
            localStorage.setItem("age", age);
            localStorage.setItem("totalAllowedInsulin", totalInsulin);
            localStorage.setItem("isf", insulin_sensetivity);

            localStorage.setItem("username", nameofuser);

            localStorage.setItem("totalAllowedBolus", bolus);
            localStorage.setItem("totalAllowedBasal", basal);

            document.getElementById("rebolus").textContent = bolus;
            document.getElementById("rebasal").textContent = basal;

            localStorage.setItem("carbRatio", carbRatio);

            const bolustype = document.getElementById("bolusType").value;
            const basaltype = document.getElementById("basalType").value;

            localStorage.setItem("bolusType", bolustype);
            localStorage.setItem("basalType", basaltype);

            const activityLevel = document.getElementById("activityLevel").value;
            localStorage.setItem("activityLevel", activityLevel);

            
            document.getElementById("insulinSensitivity").textContent = "One unit of fast-acting insulin drops your blood sugar by approximately " + insulin_sensetivity;
            document.getElementById("carbRatio").textContent = "One unit of fast-acting insulin covers approximately " + carbRatio + " grams of carbohydrates.";


            if (basal < 0) {
                swal("Be careful!", "It seems you are putting too much basal! Try reducing it. " + Math.abs(bolus), "error");
                document.getElementById("rebolus").textContent = "Limit exceeded by " + Math.abs(bolus);
                document.getElementById("rebolus").style.color = "red";
            }

            localStorage.setItem("dailyAllowedBolus", bolus);
            localStorage.setItem("dailyAllowedBasal", basal);

            swal("Success!", "Profile updated successfully.", "success");
            
            localStorage.setItem("lastLogin", new Date().toLocaleDateString());


            logDatainCloud();
            displayInsulinLogs();
            closeModal('profileModal');
        }



        

        function deleteAllData() {
            swal("Warning!", "All data will be deleted!", "warning");
            localStorage.clear();
            document.getElementById("rebolus").textContent = "Set up your profile first!";
            document.getElementById("rebasal").textContent = "Set up your profile first!";
            location.reload();
            displayInsulinLogs();
        }

        function submitInsulin() {
            const insulinAmount = parseFloat(document.getElementById("insulinno").value);
            const insulinTime = document.getElementById("insulintime").value;
            const insulinTypeInjected = document.getElementById("insulinTypeInjected").value;
            let bolus = parseFloat(localStorage.getItem("totalAllowedBolus")) || 0;
            let basal = parseFloat(localStorage.getItem("totalAllowedBasal")) || 0;
            
            if (rebolus.textContent === "Set up your profile first!" || rebasal.textContent === "Set up your profile first!") {
                swal("Cannot Log Insulin!", "Please finish customizing your profile first.", "error");
                return;
            }
            if (!insulinAmount || !insulinTime || !insulinTypeInjected) {
                swal("Error!", "Please fill in both fields.", "error");
                return;
            }

            const selectedTime = new Date(insulinTime);
            const currentTime = new Date();
            if (selectedTime > currentTime) {
                swal("Invalid Date or Time!", "You cannot log insulin for a future date or time.", "error");
                return;
            }
            if (insulinTypeInjected === "bolus") {

              bolus -= insulinAmount;
              localStorage.setItem("totalAllowedBolus", bolus);
            }
            if (insulinTypeInjected === "basal") {

              basal -= insulinAmount;
              localStorage.setItem("totalAllowedBasal", basal);
            }

            let logs = JSON.parse(localStorage.getItem("insulinLogs")) || [];
            logs.push({time: insulinTime, amount: insulinAmount});
            localStorage.setItem("insulinLogs", JSON.stringify(logs));
            
            document.getElementById("rebolus").textContent = bolus;
            document.getElementById("rebolus").style.color = "blue";
            document.getElementById("rebasal").textContent = basal;
            document.getElementById("rebasal").style.color = "blue";
            
            if (bolus < 0) {
                swal("Be careful!", "Bolus limit exceeded by " + Math.abs(bolus), "error");
                document.getElementById("rebolus").textContent = "Limit exceeded by " + Math.abs(bolus);
                document.getElementById("rebolus").style.color = "red";
            }

            swal("Success!", "Insulin data logged successfully.", "success");

            generateInsulinGraph();
            displayInsulinLogs();
        }


        function displayInsulinLogs() {
            const logs = JSON.parse(localStorage.getItem("insulinLogs")) || [];
            const logContainer = document.getElementById("logContainer");
            logContainer.innerHTML = ""; // Clear previous logs

            if (logs.length === 0) {
                logContainer.innerHTML = "<p>No logs available.</p>";
                return;
            }

            logs.forEach(log => {
                const logDiv = document.createElement("div");
                logDiv.classList.add("insulin-log");

                const amountSpan = document.createElement("span");
                amountSpan.textContent = `${log.amount} units`;

                const timeSpan = document.createElement("span");
                timeSpan.textContent = `${new Date(log.time).toLocaleString()}. Amount injected: `;

                

                logDiv.appendChild(timeSpan);
                logDiv.appendChild(amountSpan);

                logContainer.appendChild(logDiv);
            });
        }


        function generateInsulinGraph() {
            const logs = JSON.parse(localStorage.getItem("insulinLogs")) || [];
            const labels = logs.map(log => new Date(log.time).toLocaleString());
            const data = logs.map(log => log.amount);

            const ctx = document.getElementById('insulinChart').getContext('2d');

            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Insulin Amount',
                        data: data,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                    },
                    scales: {
                        x: { title: { display: true, text: 'Time' } },
                        y: { title: { display: true, text: 'Insulin Amount' }, beginAtZero: true },
                    },
                }
            });
        }


                function startUp() {
            const bolus = localStorage.getItem("totalAllowedBolus");
            const basal = localStorage.getItem("totalAllowedBasal");
            const insulin_sensitivity123 = localStorage.getItem("isf");
            const currentDate = new Date().toLocaleDateString();
            const lastLogin = localStorage.getItem("lastLogin");
            const dailybasal = localStorage.getItem("dailyAllowedBasal");
            const dailybolus = localStorage.getItem("dailyAllowedBolus");
            const themeSwitch = document.getElementById('input-theme');
            const dataCardElements = document.getElementsByClassName('mt-3');
            const carbRatio = localStorage.getItem("carbRatio");


            
            


            if (lastLogin !== currentDate) {
                swal("New day, new you!", "All your insulin data is backed up!", "success");
                localStorage.setItem("lastLogin", currentDate);
                localStorage.setItem("totalAllowedBolus", dailybolus);
                localStorage.setItem("totalAllowedBasal", dailybasal);
                location.reload();
            }

            
            if (bolus && basal && insulin_sensitivity123) {
                swal("Welcome back!", "All your insulin data is backed up!", "success");
                document.getElementById("rebolus").textContent = bolus;
                document.getElementById("rebasal").textContent = basal;
                document.getElementById("insulinSensitivity").textContent = "One unit of fast-acting insulin drops your blood sugar by approximately " + insulin_sensitivity123;
                document.getElementById("carbRatio").textContent = "One unit of fast-acting insulin covers approximately " + carbRatio + " grams of carbohydrates.";



            } else {
                swal("Welcome!", "Set up your profile to get started. Set it up in the profile tab.", "info");
            }
            
            if (bolus < 0) {
                document.getElementById("rebolus").textContent = "Limit exceeded by " + Math.abs(bolus);
                document.getElementById("rebolus").style.color = "red";
                
            }

            if (themeSwitch.checked) {
                    document.body.style.backgroundColor = 'black';
            } else {
                document.body.style.backgroundColor = 'white';
            }
            updateDateTimeDisplay();
            generateInsulinGraph();
            displayInsulinLogs();


            themeSwitch.addEventListener('change', function() {
                if (themeSwitch.checked) {
                    document.body.style.backgroundColor = 'black';
                } else {
                    document.body.style.backgroundColor = 'white';
                }
            });


        }

        


    const DAY_NAMES = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const MONTH_NAMES = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        function updateDateTimeDisplay() {
            const currentTime = new Date();
            const hourValue = currentTime.getHours();
            const minuteValue = currentTime.getMinutes();
            const formattedMinute = minuteValue < 10 ? `0${minuteValue}` : minuteValue;
            const dayName = DAY_NAMES[currentTime.getDay()];
            const monthName = MONTH_NAMES[currentTime.getMonth()];
            const dateValue = currentTime.getDate();
            const yearValue = currentTime.getFullYear();
            const timecard = document.querySelector('.timecard')
            const centerWrapper = document.querySelector('.center-wrapper');
            const dynamicBackground = document.querySelector('.l');
            const themeSwitch = document.getElementById('input-theme');
          
            if (hourValue >= 6 && hourValue <= 18) {
                timecard.style.cssText = 'background: linear-gradient(to right, rgba(255,0,0,1), rgba(254,255,0,1)) !important;'; //day

            } else {
              timecard.style.cssText = 'linear-gradient(to right, rgb(20, 30, 48), rgb(36, 59, 85)) !important;';
            }
            document.getElementById('time-text').textContent = `${hourValue}:${formattedMinute}`;
            document.getElementById('date-text').textContent = `${dayName}, ${monthName} ${dateValue}, ${yearValue}`;
      }

        function updateDateTimePlease() {
            updateDateTimeDisplay();
            setInterval(updateDateTimeDisplay, 1000);
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            document.getElementById(modalId).style.display = 'block';
            document.querySelector('.floating-btn').style.display = 'hidden'; // Hide the button

            if (modalId === 'profileModal') {
              const weightData = localStorage.getItem("weight");
              if (!weightData) {
                document.getElementById("profileModalHeading").textContent = "Set up your profile!";
              }
              else {
                document.getElementById("profileModalHeading").textContent = "Update your profile!";
              }
            }
      }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
      

        async function generatePDF() {
    const { jsPDF } = window.jspdf;

    // Create a new jsPDF instance
    const pdf = new jsPDF();
    const theusername = localStorage.getItem("username");

    // Add custom text at the top
    pdf.setFont('helvetica', 'bold');
    pdf.setFontSize(19);
    pdf.text('Insulin Report for ' + theusername, 10, 10, { align: 'center' });
    pdf.setFontSize(12);
    pdf.setFont('helvetica', 'normal');
    pdf.text('A detailed report including blood glucose levels, insulin usage, and daily logbook data.', 10, 30);

    let yOffset = 50;

    try {
        // Check if the graph element exists
        const graphElement = document.getElementById('insulinChart');
        if (!graphElement) {
            console.error('Graph element not found!');
            return;
        }
        const graphCanvas = await html2canvas(graphElement); // Capture the graph
        const graphImg = graphCanvas.toDataURL('image/png'); // Convert to image
        const { graphwidth, graphheight } = graphCanvas; // Get original dimensions
        pdf.addImage(graphImg, 'PNG', 10, yOffset, graphwidth * 0.5, graphheight * 0.5); // Add image to PDF
        yOffset += 65

        // Add a new page for insulin info
        pdf.addPage();
        pdf.setFontSize(19);
        pdf.text('Insulin Information', 10, 10, { align: 'center' });

        // Check if the insulin info element exists
        const insulinInfoElement = document.getElementById('insulinInfo');
        if (!insulinInfoElement) {
            console.error('Insulin Info element not found!');
            return;
        }
        const insulinCanvas = await html2canvas(insulinInfoElement);
        const { infowidth, infoheight } = insulinInfoElement;
        const insulinImg = insulinCanvas.toDataURL('image/png');
        pdf.addImage(insulinImg, 'PNG', 20, 10, infowidth * 0.5, infoheight * 0.5);

        // Add a new page for logbook
        yOffset = 10;
        pdf.addPage();
        pdf.setFontSize(19);
        pdf.text('Insulin Logbook', 10, 10, { align: 'center' });
        // Check if the logbook element exists
        const logbookElement = document.getElementById('insulinLogs');
        if (!logbookElement) {
            console.error('Logbook element not found!');
            return;
        }
        const logbookCanvas = await html2canvas(logbookElement);
        const { canvaswidth, canvasheight } = insulinInfoElement;
        const logbookImg = logbookCanvas.toDataURL('image/png');
        pdf.addImage(logbookImg, 'PNG', 10, 10, canvaswidth * 0.5, canvasheight * 0.5);

        // Save the PDF
        pdf.save('diabetes-report.pdf');
    } catch (error) {
        console.error('Error generating PDF:', error);
        swal("Error!", error, "error");
    }
}

    

        // Close Modal when Clicking Outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };
updateDateTimePlease();

</script>

</body>

</html>
